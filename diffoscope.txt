--- ./system-with-xserver
+++ ./install-media
├── stat {}
│ @@ -1,7 +1,7 @@
│  
│    Size: 87        	Blocks: 8          IO Block: 4096   symbolic link
│  Access: (0777/lrwxrwxrwx)  Uid: (    0/    root)   Gid: (    0/    root)
│  
│ -Modify: 2018-07-11 08:12:31.377241326 +0000
│ +Modify: 2018-07-11 08:16:21.539649828 +0000
│  
│   Birth: -
├── activate
│ @@ -1,10 +1,10 @@
│  #! /nix/store/zqh3l3lyw32q1ayb15bnvg9f24j5v2p0-bash-4.4-p12/bin/bash
│  
│ -systemConfig=/nix/store/28yw14dnfx4qn0bdpdddnqafznp8ryya-nixos-system-xps15-18.03.132192.ce0d9d638de
│ +systemConfig=/nix/store/mmbjx69kfm5623y411j496jxini5fjw3-nixos-system-nixos-18.03.132192.ce0d9d638de
│  
│  export PATH=/empty
│  for i in /nix/store/cb3slv3szhp46xkrczqw7mscy5mnk64l-coreutils-8.29 /nix/store/s63b2myh6rxfl4aqwi9yxd6rq66djk33-gnugrep-3.1 /nix/store/364b5gkvgrm87bh1scxm5h8shp975n0r-findutils-4.6.0 /nix/store/6ca5dl2wy0nh37li1n4b152fcazsp3f6-glibc-2.26-131-bin /nix/store/76a2zprra0zxg7i045hl7kldbfbzvxwn-shadow-4.5 /nix/store/vjpmcdqffck64cmvj5dkazkg4drs3a3a-net-tools-1.60_p20170221182432 /nix/store/hjm3b4h2iw34d0ia5wzxfv8pjcydkg7m-util-linux-2.31.1-bin; do
│      PATH=$PATH:$i/bin:$i/sbin
│  done
│  
│  _status=0
│ @@ -30,28 +30,28 @@
│  #### Activation script snippet users:
│  install -m 0700 -d /root
│  install -m 0755 -d /home
│  
│  /nix/store/s029gmjpgvm776wfb56naqny9qja9339-perl-5.24.3/bin/perl -w \
│    -I/nix/store/sr3z948fw4y5dwc11gvkhrsxrrjdm9k6-perl-File-Slurp-9999.19/lib/perl5/site_perl \
│    -I/nix/store/0dyml0dqfx8g0lwkvc6bgikdma0z8x4z-perl-JSON-2.90/lib/perl5/site_perl \
│ -  /nix/store/1hkp2n6hz3ybf2rvkjkwrzgbjkrrakzl-update-users-groups.pl /nix/store/7d0p61xkswhmdqn80bl24n9hwxjgbbxi-users-groups.json
│ +  /nix/store/1hkp2n6hz3ybf2rvkjkwrzgbjkrrakzl-update-users-groups.pl /nix/store/39pnhzlm7kxgrm1a77lxwpwjl7w4ag3z-users-groups.json
│  
│  
│  #### Activation script snippet groups:
│  
│  
│  #### Activation script snippet etc:
│  # Set up the statically computed bits of /etc.
│  echo "setting up /etc..."
│ -/nix/store/s029gmjpgvm776wfb56naqny9qja9339-perl-5.24.3/bin/perl -I/nix/store/sr3z948fw4y5dwc11gvkhrsxrrjdm9k6-perl-File-Slurp-9999.19/lib/perl5/site_perl /nix/store/vn1xs9s2akf79y1pbya2qldydbf2b22m-setup-etc.pl /nix/store/cn38vc189ch3blj3f6kjqirxiiyqssz2-etc/etc
│ +/nix/store/s029gmjpgvm776wfb56naqny9qja9339-perl-5.24.3/bin/perl -I/nix/store/sr3z948fw4y5dwc11gvkhrsxrrjdm9k6-perl-File-Slurp-9999.19/lib/perl5/site_perl /nix/store/vn1xs9s2akf79y1pbya2qldydbf2b22m-setup-etc.pl /nix/store/adn1zlbnv0jqwb8vj1wr9c10nd87vcmg-etc/etc
│  
│  
│  #### Activation script snippet hostname:
│ -hostname "xps15"
│ +hostname "nixos"
│  
│  
│  #### Activation script snippet specialfs:
│  specialMount() {
│    local device="$1"
│    local mountPoint="$2"
│    local options="$3"
│ @@ -126,20 +126,14 @@
│  
│  
│  # Make sure resolv.conf is up to date if not managed manually or by systemd
│  /nix/store/r0jj1vn65skrjj1k6sf3kg32lh57ihxg-openresolv-3.9.0/bin/resolvconf -u
│  
│  
│  
│ -#### Activation script snippet setup-opengl:
│ -ln -sfn /nix/store/nfnnnqj9kbd827cw110w43ybyc3bqx3p-opengl-drivers /run/opengl-driver
│ -ln -sfn /nix/store/nx4k5i79qbppb0dm017xrb82a4qqbqzp-opengl-drivers-32bit /run/opengl-driver-32
│ -
│ -
│ -
│  #### Activation script snippet systemd:
│  mkdir -m 0755 -p /var/lib/udev
│  
│  if ! [ -e /etc/machine-id ]; then
│    /nix/store/fl3mcaqqk2vg0dmk01dfbs6nbm5skpzc-systemd-237/bin/systemd-machine-id-setup
│  fi
│  
│ @@ -152,15 +146,15 @@
│  # The deprecated hotplug uevent helper is not used anymore
│  if [ -e /proc/sys/kernel/hotplug ]; then
│    echo "" > /proc/sys/kernel/hotplug
│  fi
│  
│  # Allow the kernel to find our firmware.
│  if [ -e /sys/module/firmware_class/parameters/path ]; then
│ -  echo -n "/nix/store/0ggrn2lsnpqwbw734c237188dwpawkdc-firmware/lib/firmware" > /sys/module/firmware_class/parameters/path
│ +  echo -n "/nix/store/b30kp5l2g1nygm9qbg840sfbjsp9ds46-firmware/lib/firmware" > /sys/module/firmware_class/parameters/path
│  fi
│  
│  
│  #### Activation script snippet udisks2:
│  mkdir -m 0755 -p /var/lib/udisks2
│  
│  
│ @@ -169,15 +163,15 @@
│  ln -sfn /nix/store/cb3slv3szhp46xkrczqw7mscy5mnk64l-coreutils-8.29/bin/env /usr/bin/.env.tmp
│  mv /usr/bin/.env.tmp /usr/bin/env # atomically replace /usr/bin/env
│  
│  
│  #### Activation script snippet wrappers:
│  # Look in the system path and in the default profile for
│  # programs to be wrapped.
│ -WRAPPER_PATH=/nix/store/30l6a47xjrbnkz76nr42nssy2lfvdhsz-system-path/bin:/nix/store/30l6a47xjrbnkz76nr42nssy2lfvdhsz-system-path/sbin
│ +WRAPPER_PATH=/nix/store/1bwpiry75g7wwbn8m9vgzs6b9cflvgmk-system-path/bin:/nix/store/1bwpiry75g7wwbn8m9vgzs6b9cflvgmk-system-path/sbin
│  
│  # Remove the old /var/setuid-wrappers path from the system...
│  #
│  # TODO: this is only necessary for upgrades 16.09 => 17.x;
│  # this conditional removal block needs to be removed after
│  # the release.
│  if [ -d /var/setuid-wrappers ]; then
│ @@ -318,32 +312,14 @@
│  
│  # Prevent races
│  chmod 0000 $wrapperDir/su
│  chown root.root $wrapperDir/su
│  
│  chmod "u+s,g-s,u+rx,g+x,o+x" $wrapperDir/su
│  
│ -cp /nix/store/4h108yz4k881pxihmnwi7fps2m5s392y-security-wrapper/bin/security-wrapper $wrapperDir/sudo
│ -echo -n "/nix/store/clr0n3a2w4dq8wpba27mqvjaq2jhksgk-sudo-1.8.22/bin/sudo" > $wrapperDir/sudo.real
│ -
│ -# Prevent races
│ -chmod 0000 $wrapperDir/sudo
│ -chown root.root $wrapperDir/sudo
│ -
│ -chmod "u+s,g-s,u+rx,g+x,o+x" $wrapperDir/sudo
│ -
│ -cp /nix/store/4h108yz4k881pxihmnwi7fps2m5s392y-security-wrapper/bin/security-wrapper $wrapperDir/sudoedit
│ -echo -n "/nix/store/clr0n3a2w4dq8wpba27mqvjaq2jhksgk-sudo-1.8.22/bin/sudoedit" > $wrapperDir/sudoedit.real
│ -
│ -# Prevent races
│ -chmod 0000 $wrapperDir/sudoedit
│ -chown root.root $wrapperDir/sudoedit
│ -
│ -chmod "u+s,g-s,u+rx,g+x,o+x" $wrapperDir/sudoedit
│ -
│  cp /nix/store/4h108yz4k881pxihmnwi7fps2m5s392y-security-wrapper/bin/security-wrapper $wrapperDir/unix_chkpwd
│  echo -n "/nix/store/367ldm9q7cwc82698kdq438n53fbpz4c-linux-pam-1.3.0/sbin/unix_chkpwd.orig" > $wrapperDir/unix_chkpwd.real
│  
│  # Prevent races
│  chmod 0000 $wrapperDir/unix_chkpwd
│  chown root.nogroup $wrapperDir/unix_chkpwd
│ ├── stat {}
│ │ @@ -1,7 +1,7 @@
│ │  
│ │ -  Size: 13516     	Blocks: 32         IO Block: 4096   regular file
│ │ +  Size: 12609     	Blocks: 32         IO Block: 4096   regular file
│ │  Access: (0555/-r-xr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)
│ │  
│ │  Modify: 1970-01-01 00:00:01.000000000 +0000
│ │  
│ │   Birth: -
├── bin
│ ├── switch-to-configuration
│ │ @@ -3,15 +3,15 @@
│ │  use strict;
│ │  use warnings;
│ │  use File::Basename;
│ │  use File::Slurp;
│ │  use Sys::Syslog qw(:standard :macros);
│ │  use Cwd 'abs_path';
│ │  
│ │ -my $out = "/nix/store/28yw14dnfx4qn0bdpdddnqafznp8ryya-nixos-system-xps15-18.03.132192.ce0d9d638de";
│ │ +my $out = "/nix/store/mmbjx69kfm5623y411j496jxini5fjw3-nixos-system-nixos-18.03.132192.ce0d9d638de";
│ │  
│ │  # To be robust against interruption, record what units need to be started etc.
│ │  my $startListFile = "/run/systemd/start-list";
│ │  my $restartListFile = "/run/systemd/restart-list";
│ │  my $reloadListFile = "/run/systemd/reload-list";
│ │  
│ │  my $action = shift @ARGV;
│ │ @@ -37,15 +37,15 @@
│ │  die "This is not a NixOS installation!\n" unless
│ │      -f "/etc/NIXOS" || (read_file("/etc/os-release", err_mode => 'quiet') // "") =~ /ID=nixos/s;
│ │  
│ │  openlog("nixos", "", LOG_USER);
│ │  
│ │  # Install or update the bootloader.
│ │  if ($action eq "switch" || $action eq "boot") {
│ │ -    system("/nix/store/643nbhgf6ypn9n4j80sr2wlk2sznlizh-systemd-boot-builder.py $out") == 0 or exit 1;
│ │ +    system("echo 'Warning: do not know how to make this configuration bootable; please enable a boot loader.' 1>&2; true $out") == 0 or exit 1;
│ │  }
│ │  
│ │  # Just in case the new configuration hangs the system, do a sync now.
│ │  system("/nix/store/cb3slv3szhp46xkrczqw7mscy5mnk64l-coreutils-8.29/bin/sync", "-f", "/nix/store") unless ($ENV{"NIXOS_NO_SYNC"} // "") eq "1";
│ │  
│ │  exit 0 if $action eq "boot";
│ │ ├── stat {}
│ │ │ @@ -1,7 +1,7 @@
│ │ │  
│ │ │ -  Size: 18980     	Blocks: 40         IO Block: 4096   regular file
│ │ │ +  Size: 19021     	Blocks: 40         IO Block: 4096   regular file
│ │ │  Access: (0555/-r-xr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)
│ │ │  
│ │ │  Modify: 1970-01-01 00:00:01.000000000 +0000
│ │ │  
│ │ │   Birth: -
├── etc
│┄ symlink
│ @@ -1 +1 @@
│ -destination: /nix/store/cn38vc189ch3blj3f6kjqirxiiyqssz2-etc/etc
│ +destination: /nix/store/adn1zlbnv0jqwb8vj1wr9c10nd87vcmg-etc/etc
├── extra-dependencies
│ @@ -1 +1 @@
│ -/nix/store/hd0xkk20snahizmfkkll9r7q8y4yf4q8-xkb-validated
│ +/nix/store/l3nz0167a4xhb78ldcjns5p4dwvlm1cw-stdenv /nix/store/73jpvs9j0rk37xs3r61y3aldr9sh741h-stdenv /nix/store/wwsy5zahji1jjhakq08zy3mmmvnxgnmv-busybox-1.28.1 /nix/store/8cndwak3vgf313z8l0p01mnwlkxnilsb-jq-1.5
│ ├── stat {}
│ │ @@ -1,7 +1,7 @@
│ │  
│ │ -  Size: 57        	Blocks: 8          IO Block: 4096   regular file
│ │ +  Size: 211       	Blocks: 8          IO Block: 4096   regular file
│ │  Access: (0444/-r--r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
│ │  
│ │  Modify: 1970-01-01 00:00:01.000000000 +0000
│ │  
│ │   Birth: -
├── firmware
│┄ symlink
│ @@ -1 +1 @@
│ -destination: /nix/store/0ggrn2lsnpqwbw734c237188dwpawkdc-firmware/lib/firmware
│ +destination: /nix/store/b30kp5l2g1nygm9qbg840sfbjsp9ds46-firmware/lib/firmware
├── init
│ @@ -1,10 +1,10 @@
│  #! /nix/store/zqh3l3lyw32q1ayb15bnvg9f24j5v2p0-bash-4.4-p12/bin/bash
│  
│ -systemConfig=/nix/store/28yw14dnfx4qn0bdpdddnqafznp8ryya-nixos-system-xps15-18.03.132192.ce0d9d638de
│ +systemConfig=/nix/store/mmbjx69kfm5623y411j496jxini5fjw3-nixos-system-nixos-18.03.132192.ce0d9d638de
│  
│  export HOME=/root PATH="/nix/store/cb3slv3szhp46xkrczqw7mscy5mnk64l-coreutils-8.29/bin:/nix/store/hjm3b4h2iw34d0ia5wzxfv8pjcydkg7m-util-linux-2.31.1-bin/bin:/nix/store/r0jj1vn65skrjj1k6sf3kg32lh57ihxg-openresolv-3.9.0/bin"
│  
│  
│  # Process the kernel command line.
│  for o in $(</proc/cmdline); do
│      case $o in
│ @@ -145,15 +145,15 @@
│  # Prevent the booted system form being garbage-collected If it weren't
│  # a gcroot, if we were running a different kernel, switched system,
│  # and garbage collected all, we could not load kernel modules anymore.
│  ln -sfn /run/booted-system /nix/var/nix/gcroots/booted-system
│  
│  
│  # Run any user-specified commands.
│ -/nix/store/zqh3l3lyw32q1ayb15bnvg9f24j5v2p0-bash-4.4-p12/bin/bash /nix/store/59wxjsbv5vr358q6kqlw9bxv7201mn4y-local-cmds
│ +/nix/store/zqh3l3lyw32q1ayb15bnvg9f24j5v2p0-bash-4.4-p12/bin/bash /nix/store/4199f7aabwlsrp4byyvylsq380lp3dli-local-cmds
│  
│  
│  # Reset the logging file descriptors.
│  exec 1>&$logOutFd 2>&$logErrFd
│  exec {logOutFd}>&- {logErrFd}>&-
├── initrd
│┄ symlink
│ @@ -1 +1 @@
│ -destination: /nix/store/ywc9rv4fnvixyg3cks2kayikcqgmjh1c-initrd/initrd
│ +destination: /nix/store/69inar4vh056qxs4qjnvgh5c3l1h7r8y-initrd/initrd
├── kernel
│┄ symlink
│ @@ -1 +1 @@
│ -destination: /nix/store/0hwvawn7vqgakdxhyrcqwp0cw9ajg92w-linux-4.16-rc4/bzImage
│ +destination: /nix/store/zdcm55rv82wdccgamh84mvga8nndwsfg-linux-4.14.37/bzImage
│ ├── stat {}
│ │ @@ -1,7 +1,7 @@
│ │  
│ │ -  Size: 66        	Blocks: 8          IO Block: 4096   symbolic link
│ │ +  Size: 65        	Blocks: 8          IO Block: 4096   symbolic link
│ │  Access: (0777/lrwxrwxrwx)  Uid: (    0/    root)   Gid: (    0/    root)
│ │  
│ │  Modify: 1970-01-01 00:00:01.000000000 +0000
│ │  
│ │   Birth: -
├── kernel-modules
│┄ symlink
│ @@ -1 +1 @@
│ -destination: /nix/store/bqis7za4pz9w3yv3kq3mmnq0p5a6d5np-kernel-modules
│ +destination: /nix/store/fkyd8ybav2cc6vba2sggzc9vrl7rc9q7-kernel-modules
├── kernel-params
│ @@ -1 +1 @@
│ -loglevel=4
│ +root=LABEL=NIXOS_ISO boot.shell_on_fail loglevel=4
│ ├── stat {}
│ │ @@ -1,7 +1,7 @@
│ │  
│ │ -  Size: 10        	Blocks: 8          IO Block: 4096   regular file
│ │ +  Size: 50        	Blocks: 8          IO Block: 4096   regular file
│ │  Access: (0444/-r--r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
│ │  
│ │  Modify: 1970-01-01 00:00:01.000000000 +0000
│ │  
│ │   Birth: -
├── sw
│┄ symlink
│ @@ -1 +1 @@
│ -destination: /nix/store/30l6a47xjrbnkz76nr42nssy2lfvdhsz-system-path
│ +destination: /nix/store/1bwpiry75g7wwbn8m9vgzs6b9cflvgmk-system-path
